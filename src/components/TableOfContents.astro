---
import type { MarkdownHeading } from 'astro';
import { cn } from '../lib/utils';

interface Props {
  headings: MarkdownHeading[];
  options?: {
    enableIndicator?: boolean;
  };
  class?: string;
}

const { headings, options, class: classList } = Astro.props;
---

{
  headings.length > 0 && (
    <nav
      aria-label="格活"
      data-toc-root
      class={cn(
        'not-prose h-fit rounded-md px-4 py-4',
        'bg-neutral-50 dark:bg-neutral-900',
        'border border-neutral-200 dark:border-neutral-700',
        'text-md text-neutral-800 dark:text-neutral-200',
        classList,
      )}
    >
      <div class="text-md mb-2 font-bold">格活</div>
      <ol class="list-none pl-0.5 text-sm">
        {headings.map((heading) => (
          <li
            data-toc-item
            data-toc-id={heading.slug}
            class={cn(
              'leading-8',
              options?.enableIndicator && 'transition-colors',
              options?.enableIndicator &&
                'border-l-2 border-neutral-700 pl-3 data-[target-state="before"]:border-neutral-400 data-[target-state="current"]:border-neutral-900 dark:border-neutral-300 dark:data-[target-state="before"]:border-neutral-500 dark:data-[target-state="current"]:border-neutral-100',
              options?.enableIndicator &&
                'data-[target-state="before"]:text-neutral-600 data-[target-state="current"]:text-neutral-950 dark:data-[target-state="before"]:text-neutral-300 dark:data-[target-state="current"]:text-neutral-50',
              heading.depth === 3 && 'pl-6',
            )}
          >
            <a
              data-toc-link
              data-toc-id={heading.slug}
              href={`#${heading.slug}`}
              class="no-underline"
            >
              {heading.text}
            </a>
          </li>
        ))}
      </ol>
    </nav>
  )
}

<script>
  import { initTableOfContentsState } from '../scripts/toc';

  initTableOfContentsState();
</script>
