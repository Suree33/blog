# Unsplash画像のキャッシュ実装計画

## 概要

現在のUnsplash APIを直接呼び出す実装から、画像情報をキャッシュして表示する実装に変更する。

## 実装計画

### 1. キャッシュ戦略の検討

- Cloudflare Workers KVを利用してキャッシュを実装
  - グローバルな分散キャッシュとして利用可能
  - 高速なデータ取得が可能
  - 更新が容易
- JSONファイルでの実装は以下の理由で見送り
  - サーバーレス環境でのファイルシステムの制限
  - ファイルI/Oによるパフォーマンス低下の可能性
  - 競合の可能性

### 2. キャッシュ更新の仕様

- キャッシュの有効期限や更新タイミングを設定
  - 1週間ごとに更新（毎週月曜日の午前0時など）
  - キャッシュが空の場合の更新
- 複数画像を事前に取得してキャッシュ
  - ページネーションを使用して全画像を取得（1ページ30枚）
  - 画像情報（URL、alt、blur_hash）のみを保存
  - レート制限を考慮して適切な間隔でリクエスト
- キャッシュからランダムに画像を返す
  - キャッシュされた画像群からランダムに1枚を選択
  - 同じ画像が連続で表示されないように考慮

### 3. Unsplash APIラッパーの作成

- Unsplash APIの呼び出し処理を関数化
- キャッシュ管理との連携
  - キャッシュ存在確認
  - キャッシュ更新処理
  - エラーハンドリング

### 4. APIルートの改修

- `/api/random-image`ルートの更新
  - キャッシュからのランダム画像取得
  - エラーハンドリングの強化
  - キャッシュ更新失敗時の対応

### 5. フロントエンドコンポーネントの調整

- `RandomUnsplashImage.astro`の確認
  - 新しいAPIレスポンス形式への対応
  - プロパティの調整
  - エラーハンドリングの確認

### 6. テストと検証

- キャッシュ機能の動作確認
- ランダム表示の確認
- キャッシュ更新タイミングの検証
- エラーケースの確認
